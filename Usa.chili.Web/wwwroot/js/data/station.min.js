$(function(){$("#datePicker").datetimepicker(Core.dateTimePickerDateOptions);$("#timePicker").datetimepicker(Core.dateTimePickerTimeOptions)});const App=new Vue({el:"#app",data:function(){return{stations:[],model:{stationId:Core.DEFAULT_STATION,date:null,time:null,dateTime:null},dateTimeRecorded:null,lastStationId:null,dateParam:null,stationInfo:{},stationData:[],error:null,isLoading:!1}},created:function(){Core.populateStationDropdown(this,!1);const n=new URLSearchParams(window.location.search.substring(1));this.model.stationId=n.get("id")&&!isNaN(n.get("id"))?Number(n.get("id")):Core.DEFAULT_STATION;this.model.date=n.get("date")?moment(n.get("date"),Core.DATE_PARAM_FORMAT).format(Core.DATE_FORMAT):null;this.model.time=n.get("time")?moment(n.get("time"),Core.TIME_FORMAT).format(Core.TIME_FORMAT):null;this.lastStationId=this.model.stationId;Core.getStationInfo(this,this.model.stationId);this.GetStationData()},computed:{currentDate:function(){return moment().format("MM/DD/YYYY")},currentTime:function(){return moment().format("HH:mm:ss")}},methods:{go:function(){this.GetStationData()},next:function(){this.model.dateTime&&(this.model.dateTime.add(1,"days"),$("#datePicker").data("datetimepicker").date(this.model.dateTime),$("#timePicker").data("datetimepicker").date(this.model.dateTime));this.GetStationData()},previous:function(){this.model.dateTime&&(this.model.dateTime.add(-1,"days"),$("#datePicker").data("datetimepicker").date(this.model.dateTime),$("#timePicker").data("datetimepicker").date(this.model.dateTime));this.GetStationData()},lastDateTime:function(){$("#datePicker").data("datetimepicker").date(null);$("#timePicker").data("datetimepicker").date(null);this.GetStationData()},GetStationData:function(){const n=this;if(!n.isLoading){this.model.dateTime=this.model.date&&this.model.time?moment(this.model.date+" "+this.model.time,Core.DATETIME_FORMAT):null;const t={id:n.model.stationId,date:n.model.date?moment(n.model.date,Core.DATE_FORMAT).format(Core.DATE_PARAM_FORMAT):"",time:n.model.time?moment(n.model.time,Core.TIME_FORMAT).format(Core.TIME_FORMAT):""};history.replaceState(null,null,"/Data/Station?"+new URLSearchParams(t).toString());n.error=null;$("#stationDataTable").hide();n.isLoading=!0;this.lastStationId!=this.model.stationId&&(this.lastStationId=this.model.stationId,Core.getStationInfo(this,this.model.stationId));axios.get("/data/StationData",{params:{id:n.model.stationId,dateTime:n.model.dateTime?n.model.dateTime.format(Core.DATETIME_FORMAT):null}}).then(function(t){n.isLoading=!1;const i=t.data;if(i.lastDateTimeEntry){const t=n.model.dateTime?moment(n.model.dateTime,Core.DATE_FORMAT):null,r=moment(i.firstDateTimeEntry,Core.DATETIME_FORMAT),u=moment(i.lastDateTimeEntry,Core.DATETIME_FORMAT);t!=null&&t.isBefore(r,"day")?n.error="There is no earlier data available for this station":t!=null&&t.isAfter(u,"day")?n.error="There is no later data available for this station":i.stationDataRows==null&&(n.error="There is no data available for this date and time at this station");t==null||t.isAfter(u,"day")?(n.model.dateTime=u,$("#datePicker").data("datetimepicker").date(n.model.dateTime),$("#timePicker").data("datetimepicker").date(n.model.dateTime)):t!=null&&t.isBefore(r,"day")&&(n.model.dateTime=r,$("#datePicker").data("datetimepicker").date(n.model.dateTime),$("#timePicker").data("datetimepicker").date(n.model.dateTime))}else n.error="There is no data available for this station";n.error||(n.dateParam=n.model.dateTime.format(Core.DATE_FORMAT),n.dateTimeRecorded=n.model.dateTime.format(Core.DATETIME_FORMAT),$("#stationDataTable").show(),n.stationData=i.stationDataRows,Vue.nextTick(function(){$('[data-toggle="tooltip"]').tooltip({placement:"bottom"})}))}).catch(function(t){n.isLoading=!1;console.log("GetStationData failed",t)})}}}});